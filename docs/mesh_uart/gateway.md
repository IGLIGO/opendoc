# ComiNode-GW

本文档内容描述了与蓝牙Mesh网关模块`ComiNode-GW`通信的协议格式。

## 序

协议框架如下：

![](./table_temp.png)

## 指令列表

指令列表头部的十六进制数表示指令的`索引`。

### 通知

在监测到某些事件发生时，模块会将事件通知通过接口进行上报。

- 0x01|设备入网(通知)
  - 当自动扫描搜索到新的设备，并成功添加入网后产生此通知
- 0x02|设备上线(通知)
  - 当设备由离线状态变更为在线状态时产生此通知
- 0x03|设备离线(通知)
  - 当设备由在线状态变更为离线状态时产生此通知
- 0x04|设备退网(通知)
  - 当设备成功退网时，产生此通知

### 控制

- 0x81|枚举网络设备
  - 枚举网络中已注册的所有设备地址(unicast addr)
- 0x82|获取设备类型
  - 获取指定地址(unicast addr)设备的类型
- 0x83|冻结模式(停止自动扫描添加新设备)
- 0x84|解除冻结(恢复自动扫描添加新设备)
- 0x85|设置设备订阅地址
  - 设置设备接收消息的地址(独立地址或组地址)
- 0x86|设置设备上报地址
  - 设置设备上报消息的地址(独立地址或组地址)
- 0x87|唯一地址通信(unicast addr)
  - 指定unicast地址发送消息
- 0x88|订阅地址通信(subscribe addr)
  - 指定订阅地址发送消息

## 指令内容

为简化描述，下述对指令内容的描述均只针对协议载荷部分，重复的前缀与后缀内容请参考页面顶端的框架描述。

下表为协议载荷的结构：

| Bytes | 内容     | 备注                                                     |
| ----- | -------- | -------------------------------------------------------- |
| 0     | CUID0    | 循环唯一ID                                               |
| 1     | CUID1    | 通知消息会循环增加。返回和错误消息会与请求时的CUID一致。 |
| 2     | 类型     | 0x00:通知<br>0x01:控制<br>0xAA:返回<br>0xFF:错误         |
| 3     | 索引     |                                                          |
| 4~n   | 指令内容 |                                                          |

接下来将逐条描述每个协议索引的指令内容的结构。