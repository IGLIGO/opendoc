# 手表类蓝牙产品数据通信协议



为了满足如下需求设计此协议：

- 统一协议接口，使得研发、生产、测试和使用能够在统一的协议框架下进行。
- 提供一个具有后向兼容性的，可方便扩展，逻辑清晰的通用协议。
- 提供简单轻量的路由功能，以实现跨设备间的通信。
- 兼容BLE MTU为`20byte`的情形

## 需求定义

本设计所需满足的需求如下：

 - 易解析
 - 可检错
 - 可扩展
 - 后向兼容
 - 流量控制（同步、异步）
 - 差错控制
 - 路由功能

## 修订历史
|     日期     | 备注                           |
| :--------: | :--------------------------- |
| 2017-10-29 | [v0.2.2](#!dev/changelog.md) |
| 2017-05-24 | [v0.2.1](#!dev/changelog.md) |
| 2016-05-29 | [v0.2](#!dev/changelog.md)   |


## 数据帧结构

| byte |  0   |   1   |      2      |   3    |       n | lastbyte |
| :--: | :--: | :---: | :---------: | :----: | ------: | :------: |
|  内容  | `^`  | route | flowcontrol | length | payload | checksum |

## 数据包内容

数据包包含如下内容(括号中为长度)：

- 固定字符`(1)`
- 路由信息`(1)`
- 流控信息`(1)`
- 数据包长度`(1)`
- 载荷`(0~15)`
- 校验`(1)`

### 固定字符
为了方便解析，按照惯例，使用一固定字符作为数据包首字符。
这里使用`^`作为数据包首字符。

### 路由信息
满足在设备构成的网络中进行跨设备通信的需求。

### 流量控制
控制数据传输过程，提高传输可靠性，并完成差错控制。

### 数据包长度
定义当前数据包的长度。  

Hint: 当传输数据包长度超过MTU长度时，第一包长度字节写入完整长度，后续包的长度字节均写入`0xFF`，表示为前一包内容的延续。

### 载荷
数据载荷。

### 校验和
验证数据完整性。

## 向后兼容
在两个设备建立连接时，需交流各自的版本。由移动端兼容设备端。
